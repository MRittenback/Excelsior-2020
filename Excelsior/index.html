<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Team Excelsior</title>
    <link rel="stylesheet" href="css/bulma.css">
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script src="Dependencies/jquery-3.4.1.min.js" ></script>
    <script src="Dependencies/xlsx.full.min.js"></script>
    <script src="Dependencies/plotly-latest.min.js"></script>
    <script>if (window.module) module = window.module;</script>

    <!-- OR use a specific plotly.js release (e.g. version 1.5.0) -->
    <script src="https://kit.fontawesome.com/24bd548384.js" crossorigin="anonymous"></script>
    <style>
            .collapsible {
              background-color: #777;
              color: white;
              cursor: pointer;
              padding: 18px;
              width: 100%;
              border: none;
              text-align: left;
              outline: none;
              font-size: 15px;
            }

            .active, .collapsible:hover {
              background-color: #555;
            }

            .collapsible:after {
              content: '\002B';
              color: white;
              font-weight: bold;
              float: right;
              margin-left: 5px;
            }

            .active:after {
              content: "\2212";
            }

            .content {
              padding: 0 18px;
              max-height: 0;
              overflow: hidden;
              transition: max-height 0.2s ease-out;
              background-color: #f1f1f1;
            }
            </style>
  </head>
  <body>
  <section class="section level has-background-white">
    <div class=level-left>
        <img src="img/logo.png" class="level-item" style="width:auto; height:auto; max-width:150px; max-height:60px; padding-right: 20px">
    </div>
    <div class="container">
      <h1 class="title">
        ABET Data Visulaizer
      </h1>
      <p class="subtitle">
        Created by Team Excelsior
      </p>
    </div>
    <div class="level-right">
        <img src="img/build.png" style="padding-right: 5px">
        <p class="level-item">Config</p>
    </div>
  </section>
  <section class="section has-background-link">
    <div class="columns">
        <div class="column">
            <div class="box is-half has-background-light">
                <button class="button"><img src="img/add.png" style="padding-right: 5px">Add Learning Outcome</button><br><br>
                <div id="navbar"><span>Select ABET data file (only supports 1 file currently)</span></div>
                <div id="wrapper">
                  <input type="file" id="input-excel">Choose a Excel file</input>
                </div>
                <br>
                <button onclick="createGraph()">Generate Plotly Graph</button>
                <button onclick="consoleTest()">Test Cell Value</button>
            </div>
        <!--</div>
        <div class="column">-->
            <div class="box is-half has-background-light">
                <button type="button" class="collapsible">Learning Outcome 1</button>
                <div class="content">
                    <p style="padding-top: 10px">
                        Sample text to briefly explain this learning outcome.
                    </p>
                    <div class="table is-narrow is-hoverable is-fullwidth">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Course #</th>
                                    <th>Data Collected</th>
                                    <th>Performance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><a href="">Spring543</a></td>
                                    <td>
                                        <span class="icon has-text-success">
                                            <i class="fas fa-check-square"></i>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="icon has-text-success">
                                            <i class="fas fa-check-square"></i>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="">Spring410</a></td>
                                    <td>
                                        <span class="icon has-text-warning">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="icon has-text-danger">
                                            <i class="fas fa-ban"></i>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="">Spring685</a></td>
                                    <td>
                                        <span class="icon has-text-success">
                                            <i class="fas fa-check-square"></i>
                                        </span>
                                    </td>
                                    <td>
                                        <span class="icon has-text-danger">
                                            <i class="fas fa-ban"></i>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <button type="button" class="collapsible">Learning Outcome 2</button>
                <div class="content">
                    <p style="padding-top: 10px">
                        Sample text to briefly explain this learning outcome.
                    </p>
                        <div class="table is-narrow is-hoverable is-fullwidth">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Course #</th>
                                            <th>Data Collected</th>
                                            <th>Performance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><a href="">Spring543</a></td>
                                            <td>
                                                <span class="icon has-text-success">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="icon has-text-success">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a href="">Spring410</a></td>
                                            <td>
                                                <span class="icon has-text-warning">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="icon has-text-danger">
                                                    <i class="fas fa-ban"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a href="">Spring685</a></td>
                                            <td>
                                                <span class="icon has-text-success">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="icon has-text-danger">
                                                    <i class="fas fa-ban"></i>
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                </div>
                <button type="button" class="collapsible">Learning Outcome 3</button>
                <div class="content">
                        <p style="padding-top: 10px">
                            Sample text to briefly explain this learning outcome.
                        </p>
                        <div class="table is-narrow is-hoverable is-fullwidth">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Course #</th>
                                            <th>Data Collected</th>
                                            <th>Performance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><a href="">Spring543</a></td>
                                            <td>
                                                <span class="icon has-text-success">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="icon has-text-success">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a href="">Spring410</a></td>
                                            <td>
                                                <span class="icon has-text-warning">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="icon has-text-danger">
                                                    <i class="fas fa-ban"></i>
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><a href="">Spring685</a></td>
                                            <td>
                                                <span class="icon has-text-success">
                                                    <i class="fas fa-check-square"></i>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="icon has-text-danger">
                                                    <i class="fas fa-ban"></i>
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                </div>
            </div>
        </div>
        <div class="column">
            <div class="box is-half has-background-light">
                Placeholder for future course viewer feature.
            </div>
            <div id='myDiv' style="width:600px;height:500px;">
        </div>
    </div>
  </section>
  <script>
var coll = document.getElementsByClassName("collapsible");
var i;
var excel_file = $('#input-excel');

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.maxHeight){
            content.style.maxHeight = null;
        } else {
            content.style.maxHeight = content.scrollHeight + "px";
        }
        });
    }

var le1 = [];
var le2 = [];
var le3 = [];
var le4 = [];

var sum1 = le1[0] + le2[0] + le3[0] + le4[0];
var sum2 = le1[1] + le2[1] + le3[1] + le4[1];
var sum3 = le1[2] + le2[2] + le3[2] + le4[2];
var sum4 = le1[3] + le2[3] + le3[3] + le4[3];

var wle1 = [];
var wle2 = [];
var wle3 = [];
var wle4 = [];

wle1 = [parseInt(le1[0]/sum1), parseInt(le1[1]/sum2), parseInt(le1[2]/sum3), parseInt(le1[3]/sum4)];
wle2 = [parseInt(le2[0]/sum1), parseInt(le2[1]/sum2), parseInt(le2[2]/sum3), parseInt(le2[3]/sum4)];
wle3 = [parseInt(le3[0]/sum1), parseInt(le3[1]/sum2), parseInt(le3[2]/sum3), parseInt(le3[3]/sum4)];
wle4 = [parseInt(le4[0]/sum1), parseInt(le4[1]/sum2), parseInt(le4[2]/sum3), parseInt(le4[3]/sum4)];

var albet = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R',
 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

var learnObjTitleArr;


excel_file.change(function(e){
        var reader = new FileReader();
        reader.readAsArrayBuffer(e.target.files[0]);
        reader.onload = function(e) {
                var queueText = "Summary";
                var queueCell;
                var cellRow;
                var cellCol;
                var lObjTitles = [];

                var data = new Uint8Array(reader.result);
                var wb = XLSX.read(data,{type:'array'});

                var first_sheet = wb.SheetNames[0];
                var ws = wb.Sheets[first_sheet];

                var range = XLSX.utils.decode_range(ws['!ref']); // get the range
                for(var R = range.s.r; R <= range.e.r; ++R) {
                  for(var C = range.s.c; C <= range.e.c; ++C) {
                    /* find the cell object */
                    var cellref = XLSX.utils.encode_cell({c:C, r:R}); // construct A1 reference for cell
                    if(!ws[cellref]) continue; // if cell doesn't exist, move on
                    var cell = ws[cellref];

                    /* if the cell is a text cell with the old string, change it */
                    if(!(cell.t == 's' || cell.t == 'str')) continue; // skip if cell is not text
                    if(cell.v === queueText) queueCell = cellref; // change the cell value
                  }
                }

                if (queueCell.length == 3) { //checks queue cell length and creates 2 variables for queueCell row and column
                  var s1 = queueCell[1];
                  var s2 = queueCell[2];
                  cellRow = s1.concat(s2);
                  cellCol = queueCell[0];
                } else if(queueCell.length == 2) {
                  cellRow = queueCell[1];
                  cellCol = queueCell[0];
                }
                else if (queueCell.length == 4) {
                  var s1 = queueCell[1];
                  var s2 = queueCell[2];
                  var s3 = queueCell[3];
                  var st = s1.concat(s2);
                  cellRow = st.concat(s3);
                  cellCol = queueCell[0];
                }

                console.log(cellRow);
                console.log(cellCol);

                function nextColVal(curCol) { //this takes in a str of a col and returns VALUE of next item
                  var cnt = 0;
                  var nxtCol;
                  var i;
                  for (i = 0; i < albet.length; i++) {
                    if (albet[i] == curCol) {
                      cnt++;
                      nxtCol = albet[cnt];
                      break;
                    } else {
                      cnt++;
                    }
                  }
                  return nxtCol;
                }

                function createlObjArr(summaryCellRow, summaryCellCol) { //creates an array of the learning objectives for this class
                  var nxtCol = nextColVal(summaryCellCol);
                  var curCell = nxtCol.concat(summaryCellRow);
                  while (!ws[curCell] == false) {
                    lObjTitles.push(ws[curCell].v);
                    nxtCol = nextColVal(nxtCol);
                    curCell = nxtCol.concat(summaryCellRow);
                  }
                }

                createlObjArr(cellRow, cellCol);
                learnObjTitleArr = lObjTitles;

                console.log(lObjTitles);

                function fillLe(qRow, qCol, le, x) {
                  var nxtCol = nextColVal(qCol);
                  var nxtRow = Number(qRow) + x;
                  var nxtRowStr = String(nxtRow);
                  var curCell = nxtCol.concat(nxtRowStr);
                  while (!ws[curCell] == false) {
                    le.push(ws[curCell].v);
                    nxtCol = nextColVal(nxtCol);
                    curCell = nxtCol.concat(nxtRowStr);
                  }
                }

                fillLe(cellRow, cellCol, le1, 1);
                fillLe(cellRow, cellCol, le2, 2);
                fillLe(cellRow, cellCol, le3, 3);
                fillLe(cellRow, cellCol, le4, 4);
        }
});

    function createGraph() {
      var xArr = [];
      var i;
      for (i = 0; i < learnObjTitleArr.length; i++) {
        xArr.push(learnObjTitleArr[i]);
      }

      var trace1 = {
        x: xArr,
        y: le1,
        name: '>= 4',
        type: 'bar'
      };

      var trace2 = {
        x: xArr,
        y: le2,
        name: '>= 3',
        type: 'bar'
      };

      var trace3 = {
        x: xArr,
        y: le3,
        name: '>= 2',
        type: 'bar'
      };

      var trace4 = {
        x: xArr,
        y: le4,
        name: '>= 1',
        type: 'bar'
      };

      var data = [trace1, trace2, trace3, trace4];

      var layout = {
        title: 'Distribution of Scores for CS301.3 Performance <br> Indicators in Spring 2018 (n=63)',
        font:{ family: 'Raleway, sans-serif' },
        barmode: 'stack'
      };

      Plotly.newPlot('myDiv', data, layout);
      console.log(learnObjTitleArr);

    }

    </script>
  </body>
</html>
